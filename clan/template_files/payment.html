{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Complete Payment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Razorpay Checkout Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
        }
        .summary-box {
            border: 1px solid #ddd;
            padding: 20px;
            width: 350px;
            border-radius: 10px;
        }
        .pay-btn {
            background-color: #528FF0;
            color: #fff;
            padding: 12px 25px;
            font-size: 18px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <h1>Complete Your Payment</h1>

    <div class="summary-box">
        <h2>Order Summary</h2>
        <p><strong>Order ID:</strong> {{ order.id }}</p>
        <p><strong>Name:</strong> {{ order.full_name }}</p>
        <p><strong>Email:</strong> {{ order.email }}</p>
        <p><strong>Amount:</strong> ₹{{ order.total }}</p>
    </div>

    <br>
    <button id="pay-button" class="pay-btn">Pay ₹{{ order.total }}</button>


    <script>
        var options = {
            "key": "{{ razorpay_key_id }}",
            "amount": "{{ amount_paise }}",  // in paise
            "currency": "INR",
            "name": "My Clothing Store",
            "description": "Order #{{ order.id }} Payment",
            "order_id": "{{ razorpay_order_id }}",

            "handler": function (response) {
                // Create form with payment details to verify backend
                var form = document.createElement("form");
                form.method = "POST";
                form.action = "{% url 'payment_verify' %}";

                // Add CSRF token
                var csrf = document.createElement("input");
                csrf.type = "hidden";
                csrf.name = "csrfmiddlewaretoken";
                csrf.value = "{{ csrf_token }}";
                form.appendChild(csrf);

                // Payment details
                function addField(name, value) {
                    var field = document.createElement("input");
                    field.type = "hidden";
                    field.name = name;
                    field.value = value;
                    form.appendChild(field);
                }

                addField("razorpay_payment_id", response.razorpay_payment_id);
                addField("razorpay_order_id", response.razorpay_order_id);
                addField("razorpay_signature", response.razorpay_signature);
                addField("order_id", "{{ order.id }}");

                document.body.appendChild(form);
                form.submit();
            },

            "prefill": {
                "name": "{{ order.full_name }}",
                "email": "{{ order.email }}",
                "contact": "{{ order.phone }}"
            },

            "theme": {
                "color": "#3399cc"
            }
        };

        var rzp = new Razorpay(options);

        document.getElementById("pay-button").onclick = function (e) {
            rzp.open();
            e.preventDefault();
        }
    </script>

</body>
</html>
